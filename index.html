<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daraxt ma’lumotini topish</title>
  <meta name="description" content="Daraxt ID raqamini kiriting va daraxt sahifasiga yo‘naltirilasiz." />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="page">
    <section class="card" aria-label="Daraxtni aniqlash sahifasi">
      <div class="topbar" aria-hidden="true"></div>

      <header class="header">
        <img class="logo" src="ecology.png" alt="Logo" />
      </header>

      <div class="content">
        <h1 class="title">Daraxt ma’lumotini topish</h1>
        <p class="subtitle">
          Daraxt ID raqamini kiriting. Tugmani bosing yoki Enter qiling — daraxt sahifasi ochiladi.
        </p>

        <form id="treeForm" class="form" novalidate>
          <div class="field">
            <div class="label">ID raqamini kiriting</div>

            <input
              id="treeId"
              class="input"
              type="text"
              inputmode="numeric"
              autocomplete="off"
              maxlength="20"
              placeholder="Masalan: 12345"
              aria-describedby="errorText"
            />

            <div id="errorText" class="error" role="alert" aria-live="polite"></div>
          </div>

          <button id="submitBtn" class="btn" type="submit">
            Daraxtni aniqlash
          </button>
        </form>

        <footer class="footer">
          © Ekologiya vazirligi • Yo‘naltirish: Yashil makon tizimi
        </footer>
      </div>
    </section>
  </main>

  <script>
    (function () {
      const BASE_URL = "https://yashilmakon.eco/#/tree/";

      const form = document.getElementById("treeForm");
      const input = document.getElementById("treeId");
      const error = document.getElementById("errorText");
      const btn = document.getElementById("submitBtn");

      // Telegram in-app browser popupni bloklaydi, shuning uchun uni ajratib olamiz
      function isTelegramInApp() {
        const ua = (navigator.userAgent || "").toLowerCase();
        return ua.includes("telegram") || ua.includes("tgbrowser");
      }

      function showError(msg) {
        error.textContent = msg;
        input.classList.add("input--bad");
        try { input.focus(); } catch {}
      }

      function clearError() {
        error.textContent = "";
        input.classList.remove("input--bad");
      }

      // Faqat raqam qabul qilsin (harf kirsa o‘chadi)
      input.addEventListener("input", () => {
        const cleaned = input.value.replace(/\D+/g, "");
        if (input.value !== cleaned) input.value = cleaned;
        clearError();
      });

      // Qaytib kelganda “qotib qolmasin”
      window.addEventListener("pageshow", () => { btn.disabled = false; });
      window.addEventListener("focus", () => { btn.disabled = false; });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        btn.disabled = true;
        clearError();

        const id = input.value.trim();

        if (!id) { btn.disabled = false; return showError("ID raqamini kiriting."); }
        if (!/^\d+$/.test(id)) { btn.disabled = false; return showError("Maydonga faqat raqamlar kiritiladi."); }

        const target = BASE_URL + encodeURIComponent(id);

        // ✅ Desktop/oddiy brauzer: yangi tabga urinadi
        // ✅ Telegram/mobilda blok bo‘lsa: shu oynada ochadi (fallback)
        if (!isTelegramInApp()) {
          const win = window.open(target, "_blank", "noopener,noreferrer");
          if (win) {
            // yangi tab ochildi — bu sahifa qoladi
            input.value = "";
            btn.disabled = false;
            try { input.focus(); } catch {}
            return;
          }
        }

        // Telegram yoki popup blok bo‘lsa — baribir ishlasin:
        window.location.assign(target);
      });
    })();
  </script>
</body>
</html>
